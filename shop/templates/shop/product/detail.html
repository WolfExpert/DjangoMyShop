{% extends "shop/base.html" %}
{% load static %}

{% block title %}
    {{ product.name }}
{% endblock %}
{% block content %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/detail.css' %}">

    <div class="product-detail">
        <img src="{% if product.image %}{{ product.image.url }}{% else %}
{% static "img/no_image.png" %}{% endif %}">
        <h1>{{ product.name }}</h1>
        <h2>
            <a href="{{ product.category.get_absolute_url }}">
                {{ product.category }}
            </a>
        </h2>
        <p class="price">${{ product.price }}</p>


        <form action="{% url 'cart:cart_add' product.id %}" method="post">
            {% csrf_token %}
            <div class="quantity-selector">
                <span>Quantity:</span>
                <div class="selector-with-buttons">
                    {{ cart_product_form.quantity }} <!-- Django renders the select and options here -->
                    <div class="control-buttons">
                        <button type="button" class="quantity-change plus" aria-label="Increase quantity"></button>
                        <button type="button" class="quantity-change minus" aria-label="Decrease quantity"></button>
                    </div>
                </div>
            </div>


            <button class="add-to-cart-button-small">
                <span class="add-to-cart-button-small__vector"></span>
                <span class="add-to-cart-button-small__name">Add</span>
            </button>
        </form>


        {{ product.description|linebreaks }}
    </div>
    <!-- <script src="{% static 'js/add-to-cart.js' %}"></script> -->

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var quantitySelect = document.querySelector('.quantity-selector select');
            var minusButton = document.querySelector('.quantity-change.minus');
            var plusButton = document.querySelector('.quantity-change.plus');

            if (!quantitySelect || !minusButton || !plusButton) {
                console.log('One or more elements are not found:', {
                    quantitySelect,
                    minusButton,
                    plusButton
                });
                return;
            }

            minusButton.addEventListener('click', function () {
                if (quantitySelect.selectedIndex > 0) {
                    quantitySelect.selectedIndex--;
                    quantitySelect.dispatchEvent(new Event('change')); // Trigger change event
                }
            });

            plusButton.addEventListener('click', function () {
                if (quantitySelect.selectedIndex < quantitySelect.options.length - 1) {
                    quantitySelect.selectedIndex++;
                    quantitySelect.dispatchEvent(new Event('change')); // Trigger change event
                }
            });

            quantitySelect.addEventListener('change', function () {
                console.log('Quantity changed to:', this.value);
            });
        });


    </script>
{% endblock %}